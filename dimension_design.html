<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>维度定义工具 - 数据扩展平台</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- 侧边栏 -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3>数据扩展平台</h3>
            <button id="toggle-sidebar" class="btn btn-light">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        <nav class="nav flex-column">
            <a class="nav-link" href="index.html">
                <i class="fas fa-home mr-2"></i>首页
            </a>
            <a class="nav-link" href="dashboard.html">
                <i class="fas fa-chart-bar mr-2"></i>仪表盘
            </a>
            <a class="nav-link" href="task_market.html">
                <i class="fas fa-store mr-2"></i>任务市场
            </a>
            <div class="nav-item dropdown">
                <a class="nav-link dropdown-toggle active" href="#" id="taskFlowDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-tasks mr-2"></i>任务执行流程
                </a>
                <ul class="dropdown-menu" aria-labelledby="taskFlowDropdown">
                    <li><a class="dropdown-item active" href="dimension_design.html">维度定义工具</a></li>
                    <li><a class="dropdown-item" href="data_prepopulate.html">数据预填充</a></li>
                    <li><a class="dropdown-item" href="data_cleaning.html">清洗工作台</a></li>
                    <li><a class="dropdown-item" href="work_order.html">工单发布</a></li>
                    <li><a class="dropdown-item" href="result_submit.html">结果提交</a></li>
                </ul>
            </div>
            <div class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="supportDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-cogs mr-2"></i>支撑模块
                </a>
                <ul class="dropdown-menu" aria-labelledby="supportDropdown">
                    <li><a class="dropdown-item" href="user_management.html">用户 & 权限管理</a></li>
                    <li><a class="dropdown-item" href="model_management.html">AI 模型管理</a></li>
                    <li><a class="dropdown-item" href="system_tools.html">系统工具</a></li>
                </ul>
            </div>
        </nav>
    </div>

    <!-- 主内容区域 -->
    <div class="main-content" id="main-content">
        <!-- 顶部导航栏 -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <div class="user-info">
                    <span class="welcome">欢迎，管理员</span>
                    <button class="btn btn-sm btn-outline-secondary ml-2">
                        <i class="fas fa-user-circle"></i>
                    </button>
                </div>
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="notificationsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-bell"></i>
                        <span class="badge bg-danger">3</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="notificationsDropdown">
                        <li><a class="dropdown-item" href="#">您有3个待处理工单</a></li>
                        <li><a class="dropdown-item" href="#">新的任务已发布</a></li>
                        <li><a class="dropdown-item" href="#">系统将于明天进行维护</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- 页面内容 -->
        <div class="container-fluid">
            <div class="content-section" id="dimension-design">
                <div class="task-header mb-4">
                    <div class="row">
                        <div class="col-md-9">
                            <h1>维度定义工具</h1>
                            <div class="task-info">
                                <span class="task-name">当前任务：心电图数据扩展</span>
                                <span class="task-id">DS-2024-006</span>
                                <span class="task-status">
                                    <span class="badge bg-info">进行中</span>
                                </span>
                            </div>
                        </div>
                        <div class="col-md-3 text-right">
                            <div class="version-info">
                                <span>当前版本：v1.0</span>
                                <button class="btn btn-sm btn-outline-secondary ml-2">查看历史版本</button>
                            </div>
                        </div>
                    </div>
                </div>

               
<!-- 维度设计工作区 -->
                <div class="row">
                    <!-- 维度树形结构 -->
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <div class="row">
                                    <div class="col-6">
                                        <h4 class="card-title mb-0">维度结构</h4>
                                    </div>
                                    <div class="col-6 text-right">
                                        <button class="btn btn-sm btn-primary" data-toggle="modal" data-target="#add-dimension-modal">添加维度</button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="dimension-tree">
                                    <div class="dimension-item active">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>病人基本信息</strong>
                                                <p class="text-sm text-muted">包含病人的基本身份信息</p>
                                            </div>
                                            <div>
                                                <button class="btn btn-xs btn-info"><i class="fa fa-pencil"></i></button>
                                                <button class="btn btn-xs btn-success ml-1"><i class="fa fa-plus"></i></button>
                                            </div>
                                        </div>
                                        <div class="dimension-children">
                                            <div class="dimension-item">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <span>姓名</span>
                                                        <span class="badge bg-primary ml-2">必填</span>
                                                    </div>
                                                    <button class="btn btn-xs btn-info"><i class="fa fa-pencil"></i></button>
                                                </div>
                                            </div>
                                            <div class="dimension-item">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <span>年龄</span>
                                                        <span class="badge bg-primary ml-2">必填</span>
                                                    </div>
                                                    <button class="btn btn-xs btn-info"><i class="fa fa-pencil"></i></button>
                                                </div>
                                            </div>
                                            <div class="dimension-item">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <span>性别</span>
                                                        <span class="badge bg-primary ml-2">必填</span>
                                                    </div>
                                                    <button class="btn btn-xs btn-info"><i class="fa fa-pencil"></i></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="dimension-item">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>诊断信息</strong>
                                                <p class="text-sm text-muted">基于血常规报告的诊断结果</p>
                                            </div>
                                            <div>
                                                <button class="btn btn-xs btn-info"><i class="fa fa-pencil"></i></button>
                                                <button class="btn btn-xs btn-success ml-1"><i class="fa fa-plus"></i></button>
                                            </div>
                                        </div>
                                        <div class="dimension-children">
                                            <div class="dimension-item">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <span>初步诊断</span>
                                                        <span class="badge bg-primary ml-2">必填</span>
                                                    </div>
                                                    <button class="btn btn-xs btn-info"><i class="fa fa-pencil"></i></button>
                                                </div>
                                            </div>
                                            <div class="dimension-item">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <span>建议治疗方案</span>
                                                        <span class="badge bg-secondary ml-2">选填</span>
                                                    </div>
                                                    <button class="btn btn-xs btn-info"><i class="fa fa-pencil"></i></button>
                                                </div>
                                            </div>
                                            <div class="dimension-item">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <span>预后评估</span>
                                                        <span class="badge bg-secondary ml-2">选填</span>
                                                    </div>
                                                    <button class="btn btn-xs btn-info"><i class="fa fa-pencil"></i></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="dimension-item">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>血液指标分析</strong>
                                                <p class="text-sm text-muted">基于血常规数据的详细分析</p>
                                            </div>
                                            <div>
                                                <button class="btn btn-xs btn-info"><i class="fa fa-pencil"></i></button>
                                                <button class="btn btn-xs btn-success ml-1"><i class="fa fa-plus"></i></button>
                                            </div>
                                        </div>
                                        <div class="dimension-children">
                                            <div class="dimension-item">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <span>白细胞分析</span>
                                                        <span class="badge bg-primary ml-2">必填</span>
                                                    </div>
                                                    <button class="btn btn-xs btn-info"><i class="fa fa-pencil"></i></button>
                                                </div>
                                            </div>
                                            <div class="dimension-item">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <span>红细胞分析</span>
                                                        <span class="badge bg-primary ml-2">必填</span>
                                                    </div>
                                                    <button class="btn btn-xs btn-info"><i class="fa fa-pencil"></i></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="dimension-item">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>临床建议</strong>
                                                <p class="text-sm text-muted">基于检测结果的临床建议</p>
                                            </div>
                                            <div>
                                                <button class="btn btn-xs btn-info"><i class="fa fa-pencil"></i></button>
                                                <button class="btn btn-xs btn-success ml-1"><i class="fa fa-plus"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 维度属性编辑 -->
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title mb-0">维度属性编辑</h4>
                            </div>
                            <div class="card-body">
                                <div class="dimension-form">
                                    <div class="form-group">
                                        <label for="dimension-name">维度名称</label>
                                        <input type="text" class="form-control" id="dimension-name" value="初步诊断">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="dimension-description">维度描述</label>
                                        <textarea class="form-control" id="dimension-description" rows="3">基于血常规检测报告的各项指标，给出的初步医学诊断结果</textarea>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>数据类型</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="dataType" id="dataType-text" checked>
                                            <label class="form-check-label" for="dataType-text">文本</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="dataType" id="dataType-number">
                                            <label class="form-check-label" for="dataType-number">数值</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="dataType" id="dataType-select">
                                            <label class="form-check-label" for="dataType-select">选择项</label>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="dimension-required">是否必填</label>
                                        <select class="form-control" id="dimension-required">
                                            <option value="true" selected>是</option>
                                            <option value="false">否</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="dimension-prompt">AI 提示词</label>
                                        <textarea class="form-control" id="dimension-prompt" rows="4">请根据以下血常规检测报告，生成专业的医学初步诊断结果。请确保诊断结果准确、专业，并基于提供的数据指标进行分析。

血常规检测报告:
{原始数据}

初步诊断结果:</textarea>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>依赖关系</label>
                                        <div class="d-flex items-center mb-2">
                                            <input type="checkbox" id="dependency-1" class="mr-2" checked>
                                            <label for="dependency-1">依赖于血液指标分析</label>
                                        </div>
                                        <div class="d-flex items-center">
                                            <input type="checkbox" id="dependency-2" class="mr-2">
                                            <label for="dependency-2">依赖于病人基本信息</label>
                                        </div>
                                    </div>
                                    
                                    <!-- 维度依赖可视化 -->
                                    <div class="dependency-graph" id="dependency-graph">
                                        <div class="dependency-node" style="top: 50px; left: 50px;">血液指标分析</div>
                                        <div class="dependency-node" style="top: 50px; left: 300px;">初步诊断</div>
                                        <div class="dependency-node" style="top: 150px; left: 300px;">治疗方案</div>
                                        <div class="dependency-edge" id="edge1" style="top: 75px; left: 150px; width: 150px; transform: rotate(0deg);"></div>
                                        <div class="dependency-edge" id="edge2" style="top: 100px; left: 350px; width: 0px; transform: rotate(90deg); height: 100px;"></div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="dimension-validation">验证规则</label>
                                        <textarea class="form-control" id="dimension-validation" rows="2">诊断结果必须包含至少一个医学术语，且长度不少于20个字符</textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
               

                <!-- 版本历史 -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h4 class="card-title mb-0">版本历史</h4>
                    </div>
                    <div class="card-body">
                        <div class="version-history">
                            <div class="version-item current">
                                <div class="version-info">
                                    <div class="version-number">v1.0</div>
                                    <div class="version-date">2024-05-02 14:30</div>
                                    <div class="version-author">admin</div>
                                </div>
                                <div class="version-description">创建初始维度结构，包含基本信息、心电图波形分析、异常识别、初步诊断和临床建议五个维度</div>
                                <div class="version-actions">
                                    <button class="btn btn-sm btn-outline-secondary">查看详情</button>
                                    <button class="btn btn-sm btn-outline-secondary">对比</button>
                                </div>
                            </div>
                            <div class="version-item">
                                <div class="version-info">
                                    <div class="version-number">v0.9</div>
                                    <div class="version-date">2024-05-02 10:15</div>
                                    <div class="version-author">admin</div>
                                </div>
                                <div class="version-description">AI辅助生成的初始草稿版本</div>
                                <div class="version-actions">
                                    <button class="btn btn-sm btn-outline-secondary">查看详情</button>
                                    <button class="btn btn-sm btn-outline-secondary">对比</button>
                                    <button class="btn btn-sm btn-outline-secondary">回滚到此版本</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#save-version-modal">
                            <i class="fas fa-save mr-1"></i> 保存新版本
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加维度模态框 -->
    <div class="modal fade" id="add-dimension-modal" tabindex="-1" role="dialog" aria-labelledby="add-dimension-modal-label" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="add-dimension-modal-label">添加新维度</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="add-dimension-form">
                        <div class="form-group">
                            <label for="new-dimension-name">维度名称</label>
                            <input type="text" class="form-control" id="new-dimension-name" placeholder="请输入维度名称">
                        </div>
                        <div class="form-group">
                            <label for="new-dimension-description">维度描述</label>
                            <textarea class="form-control" id="new-dimension-description" rows="2" placeholder="请输入维度描述"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="new-dimension-type">维度类型</label>
                            <select class="form-control" id="new-dimension-type">
                                <option value="category">分类维度</option>
                                <option value="attribute">属性维度</option>
                                <option value="metric">指标维度</option>
                                <option value="relationship">关系维度</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="new-dimension-parent">父维度</label>
                            <select class="form-control" id="new-dimension-parent">
                                <option value="root">根节点</option>
                                <option value="basic-info">基本信息</option>
                                <option value="waveform-analysis">心电图波形分析</option>
                                <option value="abnormality-detection">异常识别</option>
                                <option value="preliminary-diagnosis">初步诊断</option>
                                <option value="clinical-recommendations">临床建议</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="use-ai-generation"> 使用AI辅助生成
                            </label>
                            <small class="form-text text-muted">基于任务描述和现有维度，让AI推荐维度结构</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary">添加维度</button>
                </div>
            </div>
        </div>
    </div>

    <!-- AI生成预览模态框 -->
    <div class="modal fade" id="ai-generate-modal" tabindex="-1" role="dialog" aria-labelledby="ai-generate-modal-label" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ai-generate-modal-label">AI辅助生成维度</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="ai-generation">
                        <div class="form-group">
                            <label for="ai-generation-prompt">AI提示词</label>
                            <textarea class="form-control" id="ai-generation-prompt" rows="3">基于心电图数据扩展任务，生成详细的维度结构。包含病人基本信息、心电图波形分析、异常识别、初步诊断和临床建议等方面的详细维度和子维度。</textarea>
                        </div>
                        <div class="form-group">
                            <label for="ai-model-select">选择AI模型</label>
                            <select class="form-control" id="ai-model-select">
                                <option value="medical-large">医学大模型 v2.0</option>
                                <option value="general-large">通用大模型 v4.0</option>
                                <option value="text-analysis">文本分析模型 v3.5</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="generation-depth">生成深度</label>
                            <input type="range" class="form-range" id="generation-depth" min="1" max="3" value="2">
                            <div class="range-labels">
                                <span>浅</span>
                                <span>中</span>
                                <span>深</span>
                            </div>
                        </div>
                        <div class="ai-generation-results">
                            <div class="result-header">
                                <h6>AI生成结果</h6>
                                <span class="confidence-score">置信度: 92%</span>
                            </div>
                            <div class="result-content">
                                <pre>{
  "基本信息": {
    "病人ID": "string",
    "检测日期": "date",
    "年龄": "number",
    "性别": "string",
    "科室": "string",
    "检测设备": "string",
    "检测医生": "string"
  },
  "心电图波形分析": {
    "心率": "number",
    "节律": "string",
    "P波分析": {
      "形态": "string",
      "时限": "number",
      "振幅": "number"
    },
    "QRS波分析": {
      "形态": "string",
      "时限": "number",
      "振幅": "number"
    },
    "ST段分析": {
      "偏移": "number",
      "形态": "string"
    },
    "T波分析": {
      "形态": "string",
      "振幅": "number"
    }
  },
  "异常识别": {
    "异常类型": "array",
    "异常位置": "array",
    "异常程度": "string"
  },
  "初步诊断": {
    "诊断结论": "string",
    "诊断依据": "string",
    "置信度": "number"
  },
  "临床建议": {
    "进一步检查建议": "string",
    "治疗建议": "string",
    "随访建议": "string"
  }
}</pre>
                            </div>
                            <div class="ai-suggestion">
                                <div class="suggestion-header">
                                    <i class="fas fa-lightbulb text-warning"></i>
                                    <span>AI建议</span>
                                </div>
                                <div class="suggestion-content">
                                    建议增加"检测设备"和"检测医生"字段，这对数据分析和质量控制非常重要。同时，心电图波形分析可以进一步细化为P波、QRS波、ST段和T波等多个子维度，以提供更详细的分析结果。
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary">重新生成</button>
                    <button type="button" class="btn btn-success">应用此结构</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 保存版本模态框 -->
    <div class="modal fade" id="save-version-modal" tabindex="-1" role="dialog" aria-labelledby="save-version-modal-label" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="save-version-modal-label">保存新版本</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="save-version-form">
                        <div class="form-group">
                            <label for="version-name">版本名称</label>
                            <input type="text" class="form-control" id="version-name" value="v1.1" placeholder="请输入版本名称">
                        </div>
                        <div class="form-group">
                            <label for="version-description">版本说明</label>
                            <textarea class="form-control" id="version-description" rows="3" placeholder="请描述本次修改的主要内容"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="version-type">版本类型</label>
                            <select class="form-control" id="version-type">
                                <option value="major">主要版本</option>
                                <option value="minor" selected>次要版本</option>
                                <option value="patch">补丁版本</option>
                                <option value="draft">草稿版本</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="set-as-current"> 设置为当前版本
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="notify-team"> 通知团队成员
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary">保存版本</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- 自定义脚本 -->
    <script src="js/common.js"></script>
    <script src="js/dimension_design.js"></script>
</body>
</html>